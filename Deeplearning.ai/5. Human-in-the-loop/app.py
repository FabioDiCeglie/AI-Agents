from dotenv import load_dotenv

_ = load_dotenv()

from langgraph.graph import StateGraph, END
from typing import TypedDict, Annotated
import operator
from langchain_core.messages import AnyMessage, SystemMessage, HumanMessage, ToolMessage
from langchain_openai import ChatOpenAI
from langchain_community.tools.tavily_search import TavilySearchResults
from langgraph.checkpoint.sqlite import SqliteSaver

memory = SqliteSaver.from_conn_string(":memory:")

from uuid import uuid4
from langchain_core.messages import AnyMessage, SystemMessage, HumanMessage, AIMessage

"""
In previous examples we've annotated the `messages` state key
with the default `operator.add` or `+` reducer, which always
appends new messages to the end of the existing messages array.

Now, to support replacing existing messages, we annotate the
`messages` key with a customer reducer function, which replaces
messages with the same `id`, and appends them otherwise.
"""
def reduce_messages(left: list[AnyMessage], right: list[AnyMessage]) -> list[AnyMessage]:
    # assign ids to messages that don't have them
    for message in right:
        if not message.id:
            message.id = str(uuid4())
    # merge the new messages with the existing messages
    merged = left.copy()
    for message in right:
        for i, existing in enumerate(merged):
            # replace any existing messages with the same id
            if existing.id == message.id:
                merged[i] = message
                break
        else:
            # append any new messages to the end
            merged.append(message)
    return merged

class AgentState(TypedDict):
    messages: Annotated[list[AnyMessage], reduce_messages]

tool = TavilySearchResults(max_results=2)

class Agent:
    def __init__(self, model, tools, system="", checkpointer=None):
        self.system = system
        graph = StateGraph(AgentState)
        graph.add_node("llm", self.call_openai)
        graph.add_node("action", self.take_action)
        graph.add_conditional_edges("llm", self.exists_action, {True: "action", False: END})
        graph.add_edge("action", "llm")
        graph.set_entry_point("llm")
        self.graph = graph.compile(
            checkpointer=checkpointer,
            ## Interrupt before the action node to allow the human to intervene
            interrupt_before=["action"]
        )
        self.tools = {t.name: t for t in tools}
        self.model = model.bind_tools(tools)

    def call_openai(self, state: AgentState):
        messages = state['messages']
        if self.system:
            messages = [SystemMessage(content=self.system)] + messages
        message = self.model.invoke(messages)
        return {'messages': [message]}

    def exists_action(self, state: AgentState):
        print(state)
        result = state['messages'][-1]
        return len(result.tool_calls) > 0

    def take_action(self, state: AgentState):
        tool_calls = state['messages'][-1].tool_calls
        results = []
        for t in tool_calls:
            print(f"Calling: {t}")
            result = self.tools[t['name']].invoke(t['args'])
            results.append(ToolMessage(tool_call_id=t['id'], name=t['name'], content=str(result)))
        print("Back to the model!")
        return {'messages': results}

prompt = """You are a smart research assistant. Use the search engine to look up information. \
You are allowed to make multiple calls (either together or in sequence). \
Only look up information when you are sure of what you want. \
If you need to look up some information before asking a follow up question, you are allowed to do that!
"""
model = ChatOpenAI(model="gpt-3.5-turbo")
abot = Agent(model, [tool], system=prompt, checkpointer=memory)


## ------------------------------------------------------------------------------------------------

## Here we are using the agent with tools but with human approval

messages = [HumanMessage(content="Whats the weather in SF?")]
thread = {"configurable": {"thread_id": "1"}}
for event in abot.graph.stream({"messages": messages}, thread):
    for v in event.values():
        print(v['messages'])
## [HumanMessage(content='Whats the weather in SF?', id='fd1628b9-d93d-48d9-ade8-dfc94668afcb'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0', 'function': {'arguments': '{"query":"weather in San Francisco"}', 'name': 'tavily_search_results_json'}, 'type': 'function'}]}, response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 152, 'total_tokens': 174, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-57f5f6cc-9b20-4689-9183-40bc5fbbea37-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in San Francisco'}, 'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0'}])]}
## [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0', 'function': {'arguments': '{"query":"weather in San Francisco"}', 'name': 'tavily_search_results_json'}, 'type': 'function'}]}, response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 152, 'total_tokens': 174, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-57f5f6cc-9b20-4689-9183-40bc5fbbea37-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in San Francisco'}, 'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0'}])]

# Print the current state of the graph to see where we are in the execution
print(abot.graph.get_state(thread))
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in SF?', id='fd1628b9-d93d-48d9-ade8-dfc94668afcb'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in San Francisco"}', 'name': 'tavily_search_results_json'}, 'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-57f5f6cc-9b20-4689-9183-40bc5fbbea37-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in San Francisco'}, 'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0'}])]}, next=('action',), config={'configurable': {'thread_id': '1', 'thread_ts': '1f039744-4955-647a-8001-a8b7c96588af'}}, metadata={'source': 'loop', 'step': 1, 'writes': {'llm': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in San Francisco"}', 'name': 'tavily_search_results_json'}, 'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-57f5f6cc-9b20-4689-9183-40bc5fbbea37-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in San Francisco'}, 'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0'}])]}}}, created_at='2025-05-25T14:26:37.811195+00:00', parent_config={'configurable': {'thread_id': '1', 'thread_ts': '1f039744-48e7-66a8-8000-c80678b2fcb6'}})

# Print the next node that will be executed - should show 'action' since we interrupted before it
print(abot.graph.get_state(thread).next)
## ('action',)

## Continue the conversation after interrupting
for event in abot.graph.stream(None, thread):
    for v in event.values():
        print(v['messages'])
## Calling: {'name': 'tavily_search_results_json', 'args': {'query': 'weather in San Francisco'}, 'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0'}
## Back to the model!
## [ToolMessage(content="[{'url': 'https://weathershogun.com/weather/usa/ca/san-francisco/480/may/2025-05-25', 'content': 'San Francisco, California Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 63°. Night 54°. Precipitation 0 %.'}, {'url': 'https://weather5days.com/en/table/sanfrancisco,ca,usa/4day', 'content': '| 10:00 |  Fog | 10 °C | 0% | 98% | 96% | 762 mm Hg | SW 2.39 m/s | 4.3 |\\n| 11:00 |  Mist | 11 °C | 0% | 98% | 96% | 762 mm Hg | WSW 2.39 m/s | 6.5 |\\n| 12:00 |  Mist | 11 °C | 0% | 80% | 93% | 761 mm Hg | WSW 3.19 m/s | 8.3 |\\n| 13:00 |  Mist | 11 °C | 0% | 72% | 92% | 761 mm Hg | WSW 3.69 m/s | 8.9 |\\n| 14:00 |  Cloudy | 12 °C | 0% | 63% | 90% | 761 mm Hg | WSW 4 m/s | 8.4 |\\n| 15:00 |  Cloudy | 12 °C | 0% | 62% | 90% | 761 mm Hg | WSW 4.39 m/s | 6.5 | [...] | 16:00 |  Cloudy | 12 °C | 0% | 61% | 90% | 761 mm Hg | WSW 5 m/s | 4.3 |\\n| 17:00 |  Partly cloudy | 13 °C | 0% | 60% | 90% | 761 mm Hg | WSW 4.5 m/s | 2.4 |\\n| 18:00 |  Overcast | 13 °C | 0% | 100% | 73% | 760 mm Hg | WSW 4.11 m/s | 1.1 |\\n| 19:00 |  Partly cloudy | 12 °C | 0% | 56% | 78% | 760 mm Hg | WSW 4.61 m/s | 0.3 |\\n| 20:00 |  Sunny | 12 °C | 0% | 8% | 84% | 761 mm Hg | WSW 4.81 m/s | 0 |\\n| 21:00 |  Clear | 11 °C | 0% | 23% | 88% | 761 mm Hg | WSW 4.69 m/s | 0 | [...] |  |  | Temperature | Precipitation | Cloud cover | Humidity | Pressure | Wind | UV Index |\\n| --- | --- | --- | --- | --- | --- | --- | --- | --- |\\n| 00:00 |  Mist | 10 °C | 0% | 100% | 97% | 762 mm Hg | SSW 1.61 m/s | 0 |\\n| 01:00 |  Mist | 10 °C | 0% | 100% | 97% | 762 mm Hg | SSW 1.89 m/s | 0 |\\n| 02:00 |  Fog | 9 °C | 0% | 100% | 97% | 762 mm Hg | SSW 2.31 m/s | 0 |\\n| 03:00 |  Fog | 9 °C | 0% | 100% | 97% | 762 mm Hg | SSW 2.31 m/s | 0 |'}]", name='tavily_search_results_json', id='abac5806-80a7-4641-8c0d-42f6e70b1fbe', tool_call_id='call_i7rGhnzgZf5hW3bsDcqdTrH0')]}
## [HumanMessage(content='Whats the weather in SF?', id='fd1628b9-d93d-48d9-ade8-dfc94668afcb'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in San Francisco"}', 'name': 'tavily_search_results_json'}, 'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-57f5f6cc-9b20-4689-9183-40bc5fbbea37-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in San Francisco'}, 'id': 'call_i7rGhnzgZf5hW3bsDcqdTrH0'}]), ToolMessage(content="[{'url': 'https://weathershogun.com/weather/usa/ca/san-francisco/480/may/2025-05-25', 'content': 'San Francisco, California Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 63°. Night 54°. Precipitation 0 %.'}, {'url': 'https://weather5days.com/en/table/sanfrancisco,ca,usa/4day', 'content': '| 10:00 |  Fog | 10 °C | 0% | 98% | 96% | 762 mm Hg | SW 2.39 m/s | 4.3 |\\n| 11:00 |  Mist | 11 °C | 0% | 98% | 96% | 762 mm Hg | WSW 2.39 m/s | 6.5 |\\n| 12:00 |  Mist | 11 °C | 0% | 80% | 93% | 761 mm Hg | WSW 3.19 m/s | 8.3 |\\n| 13:00 |  Mist | 11 °C | 0% | 72% | 92% | 761 mm Hg | WSW 3.69 m/s | 8.9 |\\n| 14:00 |  Cloudy | 12 °C | 0% | 63% | 90% | 761 mm Hg | WSW 4 m/s | 8.4 |\\n| 15:00 |  Cloudy | 12 °C | 0% | 62% | 90% | 761 mm Hg | WSW 4.39 m/s | 6.5 | [...] | 16:00 |  Cloudy | 12 °C | 0% | 61% | 90% | 761 mm Hg | WSW 5 m/s | 4.3 |\\n| 17:00 |  Partly cloudy | 13 °C | 0% | 60% | 90% | 761 mm Hg | WSW 4.5 m/s | 2.4 |\\n| 18:00 |  Overcast | 13 °C | 0% | 100% | 73% | 760 mm Hg | WSW 4.11 m/s | 1.1 |\\n| 19:00 |  Partly cloudy | 12 °C | 0% | 56% | 78% | 760 mm Hg | WSW 4.61 m/s | 0.3 |\\n| 20:00 |  Sunny | 12 °C | 0% | 8% | 84% | 761 mm Hg | WSW 4.81 m/s | 0 |\\n| 21:00 |  Clear | 11 °C | 0% | 23% | 88% | 761 mm Hg | WSW 4.69 m/s | 0 | [...] |  |  | Temperature | Precipitation | Cloud cover | Humidity | Pressure | Wind | UV Index |\\n| --- | --- | --- | --- | --- | --- | --- | --- | --- |\\n| 00:00 |  Mist | 10 °C | 0% | 100% | 97% | 762 mm Hg | SSW 1.61 m/s | 0 |\\n| 01:00 |  Mist | 10 °C | 0% | 100% | 97% | 762 mm Hg | SSW 1.89 m/s | 0 |\\n| 02:00 |  Fog | 9 °C | 0% | 100% | 97% | 762 mm Hg | SSW 2.31 m/s | 0 |\\n| 03:00 |  Fog | 9 °C | 0% | 100% | 97% | 762 mm Hg | SSW 2.31 m/s | 0 |'}]", name='tavily_search_results_json', id='abac5806-80a7-4641-8c0d-42f6e70b1fbe', tool_call_id='call_i7rGhnzgZf5hW3bsDcqdTrH0'), AIMessage(content='The weather in San Francisco today is cloudy with overcast skies. The daytime temperature is around 63°F and it will drop to 54°F at night. There is no precipitation expected.', response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 1083, 'total_tokens': 1122, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-132c2638-f121-45ca-86ba-ca59bc6b4227-0')]}
## [AIMessage(content='The weather in San Francisco today is cloudy with overcast skies. The daytime temperature is around 63°F and it will drop to 54°F at night. There is no precipitation expected.', response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 1083, 'total_tokens': 1122, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-132c2638-f121-45ca-86ba-ca59bc6b4227-0')]}

# Check the next node - should be empty tuple () since the conversation is complete
print(abot.graph.get_state(thread).next)
## ()


## ------------------------------------------------------------------------------------------------

## COMPLETE EXAMPLE OF WORKING AGENT WITH TOOLS BUT WITH HUMAN INTERVENTION ADDING INPUT === PROCEED? IF THE ANSWER IS YES CALL THE TOOL AND RESOLVE THE CONVERSATION
messages = [HumanMessage("Whats the weather in LA?")]
thread = {"configurable": {"thread_id": "2"}}
for event in abot.graph.stream({"messages": messages}, thread):
    for v in event.values():
        print(v)
while abot.graph.get_state(thread).next:
    print("\n", abot.graph.get_state(thread),"\n")
    _input = input("proceed?")
    if _input != "y":
        print("aborting")
        break
    for event in abot.graph.stream(None, thread):
        for v in event.values():
            print(v)
## {'messages': [HumanMessage(content='Whats the weather in LA?', id='79714d99-b011-46ec-9b1e-2e27ae1c060f'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'type': 'function'}]}, response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 152, 'total_tokens': 174, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-f91392bd-eaa8-4193-8fa1-9f845e69fabc-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}
## {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'type': 'function'}]}, response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 152, 'total_tokens': 174, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-f91392bd-eaa8-4193-8fa1-9f845e69fabc-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}

## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='79714d99-b011-46ec-9b1e-2e27ae1c060f'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-f91392bd-eaa8-4193-8fa1-9f845e69fabc-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}, next=('action',), config={'configurable': {'thread_id': '2', 'thread_ts': '1f039751-3cb7-6321-8001-f3bc8333033c'}}, metadata={'source': 'loop', 'step': 1, 'writes': {'llm': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-f91392bd-eaa8-4193-8fa1-9f845e69fabc-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}}}, created_at='2025-05-25T14:32:25.454244+00:00', parent_config={'configurable': {'thread_id': '2', 'thread_ts': '1f039751-3c6f-6417-8000-fe69b23d7d68'}}) 

##proceed? y

## Calling: {'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}
## Back to the model!
## {'messages': [ToolMessage(content='[{\'url\': \'https://weathershogun.com/weather/usa/ca/los-angeles/451/may/2025-05-25\', \'content\': \'Los Angeles, California Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 77°. Night 61°. Precipitation 0 %.\'}, {\'url\': \'https://en.climate-data.org/north-america/united-states-of-america/california/los-angeles-714829/t/may-5/\', \'content\': "May is an excellent time to visit Los Angeles due to its mild and pleasant weather. With temperatures ranging from the mid-60s to low 70s Fahrenheit, it\'s perfect for exploring the city comfortably. During this month, you can enjoy clear skies and less crowded tourist spots. A must-visit is Griffith Observatory, where you can get stunning views of the city and the iconic Hollywood sign. Another great attraction is The Getty Center, offering impressive art collections and beautiful gardens. [...] (66.9) °F\\n\\n21.4 °C\\n\\n(70.5) °F\\n\\n23.3 °C\\n\\n(73.9) °F\\n\\n25.2 °C\\n\\n(77.4) °F\\n\\n28.1 °C\\n\\n(82.6) °F\\n\\n31.3 °C\\n\\n(88.3) °F\\n\\n31.9 °C\\n\\n(89.5) °F\\n\\n31 °C\\n\\n(87.7) °F\\n\\n27.2 °C\\n\\n(81) °F\\n\\n23.1 °C\\n\\n(73.5) °F\\n\\n18.8 °C\\n\\n(65.9) °F\\n\\n84\\n\\n(3)\\n\\n89\\n\\n(3)\\n\\n54\\n\\n(2)\\n\\n19\\n\\n(0)\\n\\n11\\n\\n(0)\\n\\n3\\n\\n(0)\\n\\n2\\n\\n(0)\\n\\n0\\n\\n(0)\\n\\n4\\n\\n(0)\\n\\n17\\n\\n(0)\\n\\n21\\n\\n(0)\\n\\n53\\n\\n(2) [...] Min. Temperature °C (°F) | 6.7 °C(44.1) °F | 6.8 °C(44.2) °F | 8.3 °C(47) °F | 9.7 °C(49.5) °F | 12.3 °C(54.1) °F | 15 °C(58.9) °F | 17.9 °C(64.3) °F | 18.2 °C(64.8) °F | 17 °C(62.6) °F | 13.6 °C(56.5) °F | 9.8 °C(49.7) °F | 6.5 °C(43.8) °F\\nMax. Temperature °C (°F) | 19.5 °C(67.2) °F | 19.4 °C(66.9) °F | 21.4 °C(70.5) °F | 23.3 °C(73.9) °F | 25.2 °C(77.4) °F | 28.1 °C(82.6) °F | 31.3 °C(88.3) °F | 31.9 °C(89.5) °F | 31 °C(87.7) °F | 27.2 °C(81) °F | 23.1 °C(73.5) °F | 18.8 °C(65.9) °F"}]', name='tavily_search_results_json', id='d7a239a2-0552-49a4-8dee-160953c6c37b', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc')]}
## {'messages': [HumanMessage(content='Whats the weather in LA?', id='79714d99-b011-46ec-9b1e-2e27ae1c060f'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-f91392bd-eaa8-4193-8fa1-9f845e69fabc-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}]), ToolMessage(content='[{\'url\': \'https://weathershogun.com/weather/usa/ca/los-angeles/451/may/2025-05-25\', \'content\': \'Los Angeles, California Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 77°. Night 61°. Precipitation 0 %.\'}, {\'url\': \'https://en.climate-data.org/north-america/united-states-of-america/california/los-angeles-714829/t/may-5/\', \'content\': "May is an excellent time to visit Los Angeles due to its mild and pleasant weather. With temperatures ranging from the mid-60s to low 70s Fahrenheit, it\'s perfect for exploring the city comfortably. During this month, you can enjoy clear skies and less crowded tourist spots. A must-visit is Griffith Observatory, where you can get stunning views of the city and the iconic Hollywood sign. Another great attraction is The Getty Center, offering impressive art collections and beautiful gardens. [...] (66.9) °F\\n\\n21.4 °C\\n\\n(70.5) °F\\n\\n23.3 °C\\n\\n(73.9) °F\\n\\n25.2 °C\\n\\n(77.4) °F\\n\\n28.1 °C\\n\\n(82.6) °F\\n\\n31.3 °C\\n\\n(88.3) °F\\n\\n31.9 °C\\n\\n(89.5) °F\\n\\n31 °C\\n\\n(87.7) °F\\n\\n27.2 °C\\n\\n(81) °F\\n\\n23.1 °C\\n\\n(73.5) °F\\n\\n18.8 °C\\n\\n(65.9) °F\\n\\n84\\n\\n(3)\\n\\n89\\n\\n(3)\\n\\n54\\n\\n(2)\\n\\n19\\n\\n(0)\\n\\n11\\n\\n(0)\\n\\n3\\n\\n(0)\\n\\n2\\n\\n(0)\\n\\n0\\n\\n(0)\\n\\n4\\n\\n(0)\\n\\n17\\n\\n(0)\\n\\n21\\n\\n(0)\\n\\n53\\n\\n(2) [...] Min. Temperature °C (°F) | 6.7 °C(44.1) °F | 6.8 °C(44.2) °F | 8.3 °C(47) °F | 9.7 °C(49.5) °F | 12.3 °C(54.1) °F | 15 °C(58.9) °F | 17.9 °C(64.3) °F | 18.2 °C(64.8) °F | 17 °C(62.6) °F | 13.6 °C(56.5) °F | 9.8 °C(49.7) °F | 6.5 °C(43.8) °F\\nMax. Temperature °C (°F) | 19.5 °C(67.2) °F | 19.4 °C(66.9) °F | 21.4 °C(70.5) °F | 23.3 °C(73.9) °F | 25.2 °C(77.4) °F | 28.1 °C(82.6) °F | 31.3 °C(88.3) °F | 31.9 °C(89.5) °F | 31 °C(87.7) °F | 27.2 °C(81) °F | 23.1 °C(73.5) °F | 18.8 °C(65.9) °F"}]', name='tavily_search_results_json', id='d7a239a2-0552-49a4-8dee-160953c6c37b', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc'), AIMessage(content='The weather in Los Angeles today is cloudy with overcast skies and temperatures reaching 77°F during the day and dropping to 61°F at night. There is no precipitation expected. Los Angeles in May generally has mild and pleasant weather with temperatures ranging from the mid-60s to low 70s Fahrenheit, making it perfect for exploring the city comfortably.', response_metadata={'token_usage': {'completion_tokens': 72, 'prompt_tokens': 1013, 'total_tokens': 1085, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-c029b28b-0388-42ac-ab13-373efd71f957-0')]}
## {'messages': [AIMessage(content='The weather in Los Angeles today is cloudy with overcast skies and temperatures reaching 77°F during the day and dropping to 61°F at night. There is no precipitation expected. Los Angeles in May generally has mild and pleasant weather with temperatures ranging from the mid-60s to low 70s Fahrenheit, making it perfect for exploring the city comfortably.', response_metadata={'token_usage': {'completion_tokens': 72, 'prompt_tokens': 1013, 'total_tokens': 1085, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-c029b28b-0388-42ac-ab13-373efd71f957-0')]}


## ------------------------------------------------------------------------------------------------

## WITH LANGGRAPH WE CAN ALSO USE "TIME TRAVEL" TO NAVIGATE THROUGH DIFFERENT STATES IN THE CONVERSATION HISTORY

messages = [HumanMessage("Whats the weather in LA?")]
thread = {"configurable": {"thread_id": "3"}}
for event in abot.graph.stream({"messages": messages}, thread):
    for v in event.values():
        print(v)
## {'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'type': 'function'}]}, response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 152, 'total_tokens': 174, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}
## {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'type': 'function'}]}, response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 152, 'total_tokens': 174, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}

print(abot.graph.get_state(thread))
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}, next=('action',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c35d-6c36-8001-52372a1ac822'}}, metadata={'source': 'loop', 'step': 1, 'writes': {'llm': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}}}, created_at='2025-05-25T14:37:08.008844+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c324-6002-8000-81d957caa9af'}})

current_values = abot.graph.get_state(thread)
print(current_values.values['messages'][-1].tool_calls)
## [{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}];

_id = current_values.values['messages'][-1].tool_calls[0]['id']
current_values.values['messages'][-1].tool_calls = [
    {'name': 'tavily_search_results_json',
  'args': {'query': 'current weather in Louisiana'},
  'id': _id}
]

abot.graph.update_state(thread, current_values.values)

print(abot.graph.get_state(thread))
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in Louisiana'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}, next=('action',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975f-6f53-6beb-8002-354e9632f91e'}}, metadata={'source': 'update', 'step': 2, 'writes': {'llm': {'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in Louisiana'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}}}, created_at='2025-05-25T14:38:46.570894+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c35d-6c36-8001-52372a1ac822'}})

for event in abot.graph.stream(None, thread):
    for v in event.values():
        print(v)
## Calling: {'name': 'tavily_search_results_json', 'args': {'query': 'current weather in Louisiana'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}
## Back to the model!
## {'messages': [ToolMessage(content='[{\'url\': \'https://www.timeanddate.com/weather/usa/new-orleans\', \'content\': \'Weather in New Orleans, Louisiana, USA\\n\\nPartly sunny.\\n\\nFeels Like: 94\\xa0°FForecast: 90 / 76\\xa0°FWind: 7 mph ↑ from South\\n\\nLocation: | Lakefront Airport\\nCurrent Time: | May 25, 2025 at 9:41:20 am\\nLatest Report: | May 25, 2025 at 9:09 am\\nVisibility: | 10\\xa0mi\\nPressure: | 30.10 "Hg\\nHumidity: | 75%\\nDew Point: | 76\\xa0°F\\nUpcoming 5 hours\\n\\nNow | 10:00 am | 11:00 am | 12:00 pm | 1:00 pm | 2:00 pm\\n |  |  |  |  | \\n85\\xa0°F | 86\\xa0°F | 87\\xa0°F | 88\\xa0°F | 89\\xa0°F | 89\\xa0°F\\nSee more hour-by-hour weather [...] * Updated Sunday, May 25, 2025 8:03:02 am New Orleans time - Weather by CustomWeather, © 2025\\n14 day forecast, day-by-dayHour-by-hour forecast for next week [...] Sun | Mon | Tue | Wed | Thu | Fri | Sat\\n2590 / 76\\xa0°F | 2691 / 77\\xa0°F | 2790 / 78\\xa0°F | 2889 / 73\\xa0°F | 2987 / 73\\xa0°F | 3092 / 75\\xa0°F | 3183 / 71\\xa0°F\\n186 / 68\\xa0°F | 286 / 64\\xa0°F | 388 / 63\\xa0°F | 488 / 64\\xa0°F | 588 / 64\\xa0°F | 691 / 65\\xa0°F | 795 / 68\\xa0°F\\n893 / 69\\xa0°F | 9 | 10 | 11 | 12 | 13 | 14\\n90 / 76\\xa0°F\\n\\n91 / 77\\xa0°F\\n\\n90 / 78\\xa0°F\\n\\n89 / 73\\xa0°F\\n\\n87 / 73\\xa0°F\\n\\n92 / 75\\xa0°F\\n\\n83 / 71\\xa0°F\\n\\n86 / 68\\xa0°F\\n\\n86 / 64\\xa0°F\\n\\n88 / 63\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n91 / 65\\xa0°F\\n\\n95 / 68\\xa0°F\\n\\n93 / 69\\xa0°F\\n\\nDetailed forecast for 14 days\'}, {\'url\': \'https://weathershogun.com/weather/usa/la/new-orleans/1865/may/2025-05-25\', \'content\': \'New Orleans, Louisiana Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 91°. Night 73°. Precipitation 10 %.\'}]', name='tavily_search_results_json', id='1e49bb5b-6afa-4e54-be1b-77301789d1ab', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc')]}
## {'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in Louisiana'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}]), ToolMessage(content='[{\'url\': \'https://www.timeanddate.com/weather/usa/new-orleans\', \'content\': \'Weather in New Orleans, Louisiana, USA\\n\\nPartly sunny.\\n\\nFeels Like: 94\\xa0°FForecast: 90 / 76\\xa0°FWind: 7 mph ↑ from South\\n\\nLocation: | Lakefront Airport\\nCurrent Time: | May 25, 2025 at 9:41:20 am\\nLatest Report: | May 25, 2025 at 9:09 am\\nVisibility: | 10\\xa0mi\\nPressure: | 30.10 "Hg\\nHumidity: | 75%\\nDew Point: | 76\\xa0°F\\nUpcoming 5 hours\\n\\nNow | 10:00 am | 11:00 am | 12:00 pm | 1:00 pm | 2:00 pm\\n |  |  |  |  | \\n85\\xa0°F | 86\\xa0°F | 87\\xa0°F | 88\\xa0°F | 89\\xa0°F | 89\\xa0°F\\nSee more hour-by-hour weather [...] * Updated Sunday, May 25, 2025 8:03:02 am New Orleans time - Weather by CustomWeather, © 2025\\n14 day forecast, day-by-dayHour-by-hour forecast for next week [...] Sun | Mon | Tue | Wed | Thu | Fri | Sat\\n2590 / 76\\xa0°F | 2691 / 77\\xa0°F | 2790 / 78\\xa0°F | 2889 / 73\\xa0°F | 2987 / 73\\xa0°F | 3092 / 75\\xa0°F | 3183 / 71\\xa0°F\\n186 / 68\\xa0°F | 286 / 64\\xa0°F | 388 / 63\\xa0°F | 488 / 64\\xa0°F | 588 / 64\\xa0°F | 691 / 65\\xa0°F | 795 / 68\\xa0°F\\n893 / 69\\xa0°F | 9 | 10 | 11 | 12 | 13 | 14\\n90 / 76\\xa0°F\\n\\n91 / 77\\xa0°F\\n\\n90 / 78\\xa0°F\\n\\n89 / 73\\xa0°F\\n\\n87 / 73\\xa0°F\\n\\n92 / 75\\xa0°F\\n\\n83 / 71\\xa0°F\\n\\n86 / 68\\xa0°F\\n\\n86 / 64\\xa0°F\\n\\n88 / 63\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n91 / 65\\xa0°F\\n\\n95 / 68\\xa0°F\\n\\n93 / 69\\xa0°F\\n\\nDetailed forecast for 14 days\'}, {\'url\': \'https://weathershogun.com/weather/usa/la/new-orleans/1865/may/2025-05-25\', \'content\': \'New Orleans, Louisiana Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 91°. Night 73°. Precipitation 10 %.\'}]', name='tavily_search_results_json', id='1e49bb5b-6afa-4e54-be1b-77301789d1ab', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc'), AIMessage(content='The current weather in Louisiana, specifically in New Orleans, is partly sunny with a temperature of 85°F. It feels like 94°F with a forecast of 90°F for the day. The wind is blowing at 7 mph from the south. The humidity is at 75% with a dew point of 76°F.', response_metadata={'token_usage': {'completion_tokens': 68, 'prompt_tokens': 871, 'total_tokens': 939, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-21900668-6df8-4734-a7b0-2fd0bbe60f9c-0')]}
## {'messages': [AIMessage(content='The current weather in Louisiana, specifically in New Orleans, is partly sunny with a temperature of 85°F. It feels like 94°F with a forecast of 90°F for the day. The wind is blowing at 7 mph from the south. The humidity is at 75% with a dew point of 76°F.', response_metadata={'token_usage': {'completion_tokens': 68, 'prompt_tokens': 871, 'total_tokens': 939, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-21900668-6df8-4734-a7b0-2fd0bbe60f9c-0')]}


## ------------------------------------------------------------------------------------------------

## WITH LANGGRAPH WE CAN ALSO USE "TIME TRAVEL" TO NAVIGATE THROUGH DIFFERENT STATES IN THE CONVERSATION HISTORY

# Let's collect all states from the conversation history
# The states are returned in reverse chronological order (newest first)
states = []
for state in abot.graph.get_state_history(thread):
    print(state)
    print('--')
    states.append(state)
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in Louisiana'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}]), ToolMessage(content='[{\'url\': \'https://www.timeanddate.com/weather/usa/new-orleans\', \'content\': \'Weather in New Orleans, Louisiana, USA\\n\\nPartly sunny.\\n\\nFeels Like: 94\\xa0°FForecast: 90 / 76\\xa0°FWind: 7 mph ↑ from South\\n\\nLocation: | Lakefront Airport\\nCurrent Time: | May 25, 2025 at 9:41:20 am\\nLatest Report: | May 25, 2025 at 9:09 am\\nVisibility: | 10\\xa0mi\\nPressure: | 30.10 "Hg\\nHumidity: | 75%\\nDew Point: | 76\\xa0°F\\nUpcoming 5 hours\\n\\nNow | 10:00 am | 11:00 am | 12:00 pm | 1:00 pm | 2:00 pm\\n |  |  |  |  | \\n85\\xa0°F | 86\\xa0°F | 87\\xa0°F | 88\\xa0°F | 89\\xa0°F | 89\\xa0°F\\nSee more hour-by-hour weather [...] * Updated Sunday, May 25, 2025 8:03:02 am New Orleans time - Weather by CustomWeather, © 2025\\n14 day forecast, day-by-dayHour-by-hour forecast for next week [...] Sun | Mon | Tue | Wed | Thu | Fri | Sat\\n2590 / 76\\xa0°F | 2691 / 77\\xa0°F | 2790 / 78\\xa0°F | 2889 / 73\\xa0°F | 2987 / 73\\xa0°F | 3092 / 75\\xa0°F | 3183 / 71\\xa0°F\\n186 / 68\\xa0°F | 286 / 64\\xa0°F | 388 / 63\\xa0°F | 488 / 64\\xa0°F | 588 / 64\\xa0°F | 691 / 65\\xa0°F | 795 / 68\\xa0°F\\n893 / 69\\xa0°F | 9 | 10 | 11 | 12 | 13 | 14\\n90 / 76\\xa0°F\\n\\n91 / 77\\xa0°F\\n\\n90 / 78\\xa0°F\\n\\n89 / 73\\xa0°F\\n\\n87 / 73\\xa0°F\\n\\n92 / 75\\xa0°F\\n\\n83 / 71\\xa0°F\\n\\n86 / 68\\xa0°F\\n\\n86 / 64\\xa0°F\\n\\n88 / 63\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n91 / 65\\xa0°F\\n\\n95 / 68\\xa0°F\\n\\n93 / 69\\xa0°F\\n\\nDetailed forecast for 14 days\'}, {\'url\': \'https://weathershogun.com/weather/usa/la/new-orleans/1865/may/2025-05-25\', \'content\': \'New Orleans, Louisiana Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 91°. Night 73°. Precipitation 10 %.\'}]', name='tavily_search_results_json', id='1e49bb5b-6afa-4e54-be1b-77301789d1ab', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc'), AIMessage(content='The current weather in Louisiana, specifically in New Orleans, is partly sunny with a temperature of 85°F. It feels like 94°F with a forecast of 90°F for the day. The wind is blowing at 7 mph from the south. The humidity is at 75% with a dew point of 76°F.', response_metadata={'finish_reason': 'stop', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 68, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 871, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 939}}, id='run-21900668-6df8-4734-a7b0-2fd0bbe60f9c-0')]}, next=(), config={'configurable': {'thread_id': '3', 'thread_ts': '1f039765-4b34-6e4d-8004-ed20726c8e4b'}}, metadata={'source': 'loop', 'step': 4, 'writes': {'llm': {'messages': [AIMessage(content='The current weather in Louisiana, specifically in New Orleans, is partly sunny with a temperature of 85°F. It feels like 94°F with a forecast of 90°F for the day. The wind is blowing at 7 mph from the south. The humidity is at 75% with a dew point of 76°F.', response_metadata={'finish_reason': 'stop', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 68, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 871, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 939}}, id='run-21900668-6df8-4734-a7b0-2fd0bbe60f9c-0')]}}}, created_at='2025-05-25T14:41:23.844647+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f039765-441d-6341-8003-6d2fec52ff62'}})
## --
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in Louisiana'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}]), ToolMessage(content='[{\'url\': \'https://www.timeanddate.com/weather/usa/new-orleans\', \'content\': \'Weather in New Orleans, Louisiana, USA\\n\\nPartly sunny.\\n\\nFeels Like: 94\\xa0°FForecast: 90 / 76\\xa0°FWind: 7 mph ↑ from South\\n\\nLocation: | Lakefront Airport\\nCurrent Time: | May 25, 2025 at 9:41:20 am\\nLatest Report: | May 25, 2025 at 9:09 am\\nVisibility: | 10\\xa0mi\\nPressure: | 30.10 "Hg\\nHumidity: | 75%\\nDew Point: | 76\\xa0°F\\nUpcoming 5 hours\\n\\nNow | 10:00 am | 11:00 am | 12:00 pm | 1:00 pm | 2:00 pm\\n |  |  |  |  | \\n85\\xa0°F | 86\\xa0°F | 87\\xa0°F | 88\\xa0°F | 89\\xa0°F | 89\\xa0°F\\nSee more hour-by-hour weather [...] * Updated Sunday, May 25, 2025 8:03:02 am New Orleans time - Weather by CustomWeather, © 2025\\n14 day forecast, day-by-dayHour-by-hour forecast for next week [...] Sun | Mon | Tue | Wed | Thu | Fri | Sat\\n2590 / 76\\xa0°F | 2691 / 77\\xa0°F | 2790 / 78\\xa0°F | 2889 / 73\\xa0°F | 2987 / 73\\xa0°F | 3092 / 75\\xa0°F | 3183 / 71\\xa0°F\\n186 / 68\\xa0°F | 286 / 64\\xa0°F | 388 / 63\\xa0°F | 488 / 64\\xa0°F | 588 / 64\\xa0°F | 691 / 65\\xa0°F | 795 / 68\\xa0°F\\n893 / 69\\xa0°F | 9 | 10 | 11 | 12 | 13 | 14\\n90 / 76\\xa0°F\\n\\n91 / 77\\xa0°F\\n\\n90 / 78\\xa0°F\\n\\n89 / 73\\xa0°F\\n\\n87 / 73\\xa0°F\\n\\n92 / 75\\xa0°F\\n\\n83 / 71\\xa0°F\\n\\n86 / 68\\xa0°F\\n\\n86 / 64\\xa0°F\\n\\n88 / 63\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n91 / 65\\xa0°F\\n\\n95 / 68\\xa0°F\\n\\n93 / 69\\xa0°F\\n\\nDetailed forecast for 14 days\'}, {\'url\': \'https://weathershogun.com/weather/usa/la/new-orleans/1865/may/2025-05-25\', \'content\': \'New Orleans, Louisiana Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 91°. Night 73°. Precipitation 10 %.\'}]', name='tavily_search_results_json', id='1e49bb5b-6afa-4e54-be1b-77301789d1ab', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc')]}, next=('llm',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f039765-441d-6341-8003-6d2fec52ff62'}}, metadata={'source': 'loop', 'step': 3, 'writes': {'action': {'messages': [ToolMessage(content='[{\'url\': \'https://www.timeanddate.com/weather/usa/new-orleans\', \'content\': \'Weather in New Orleans, Louisiana, USA\\n\\nPartly sunny.\\n\\nFeels Like: 94\\xa0°FForecast: 90 / 76\\xa0°FWind: 7 mph ↑ from South\\n\\nLocation: | Lakefront Airport\\nCurrent Time: | May 25, 2025 at 9:41:20 am\\nLatest Report: | May 25, 2025 at 9:09 am\\nVisibility: | 10\\xa0mi\\nPressure: | 30.10 "Hg\\nHumidity: | 75%\\nDew Point: | 76\\xa0°F\\nUpcoming 5 hours\\n\\nNow | 10:00 am | 11:00 am | 12:00 pm | 1:00 pm | 2:00 pm\\n |  |  |  |  | \\n85\\xa0°F | 86\\xa0°F | 87\\xa0°F | 88\\xa0°F | 89\\xa0°F | 89\\xa0°F\\nSee more hour-by-hour weather [...] * Updated Sunday, May 25, 2025 8:03:02 am New Orleans time - Weather by CustomWeather, © 2025\\n14 day forecast, day-by-dayHour-by-hour forecast for next week [...] Sun | Mon | Tue | Wed | Thu | Fri | Sat\\n2590 / 76\\xa0°F | 2691 / 77\\xa0°F | 2790 / 78\\xa0°F | 2889 / 73\\xa0°F | 2987 / 73\\xa0°F | 3092 / 75\\xa0°F | 3183 / 71\\xa0°F\\n186 / 68\\xa0°F | 286 / 64\\xa0°F | 388 / 63\\xa0°F | 488 / 64\\xa0°F | 588 / 64\\xa0°F | 691 / 65\\xa0°F | 795 / 68\\xa0°F\\n893 / 69\\xa0°F | 9 | 10 | 11 | 12 | 13 | 14\\n90 / 76\\xa0°F\\n\\n91 / 77\\xa0°F\\n\\n90 / 78\\xa0°F\\n\\n89 / 73\\xa0°F\\n\\n87 / 73\\xa0°F\\n\\n92 / 75\\xa0°F\\n\\n83 / 71\\xa0°F\\n\\n86 / 68\\xa0°F\\n\\n86 / 64\\xa0°F\\n\\n88 / 63\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n88 / 64\\xa0°F\\n\\n91 / 65\\xa0°F\\n\\n95 / 68\\xa0°F\\n\\n93 / 69\\xa0°F\\n\\nDetailed forecast for 14 days\'}, {\'url\': \'https://weathershogun.com/weather/usa/la/new-orleans/1865/may/2025-05-25\', \'content\': \'New Orleans, Louisiana Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 91°. Night 73°. Precipitation 10 %.\'}]', name='tavily_search_results_json', id='1e49bb5b-6afa-4e54-be1b-77301789d1ab', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc')]}}}, created_at='2025-05-25T14:41:23.100937+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975f-6f53-6beb-8002-354e9632f91e'}})
## --
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in Louisiana'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}, next=('action',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975f-6f53-6beb-8002-354e9632f91e'}}, metadata={'source': 'update', 'step': 2, 'writes': {'llm': {'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in Louisiana'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}}}, created_at='2025-05-25T14:38:46.570894+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c35d-6c36-8001-52372a1ac822'}})
## --
# states[-3] = State with ORIGINAL tool call for "weather in Los Angeles", ready for action (THIS IS OUR TARGET)
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}, next=('action',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c35d-6c36-8001-52372a1ac822'}}, metadata={'source': 'loop', 'step': 1, 'writes': {'llm': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}}}, created_at='2025-05-25T14:37:08.008844+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c324-6002-8000-81d957caa9af'}})
## --
# states[-2] = State with just human message, ready for LLM  
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee')]}, next=('llm',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c324-6002-8000-81d957caa9af'}}, metadata={'source': 'loop', 'step': 0, 'writes': None}, created_at='2025-05-25T14:37:07.985185+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c31e-6eda-bfff-36563e3492f9'}})
## --
# states[-1] = Initial empty state (__start__)
## StateSnapshot(values={'messages': []}, next=('__start__',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c31e-6eda-bfff-36563e3492f9'}}, metadata={'source': 'input', 'step': -1, 'writes': {'messages': [HumanMessage(content='Whats the weather in LA?')]}}, created_at='2025-05-25T14:37:07.983116+00:00', parent_config=None)
## --

## To fetch the same state as was filmed, the offset below is changed to -3 from -1. 
## This accounts for the initial state __start__ and the first state that are now stored to state memory with the latest version of software.
## We want to go back to the state where the ORIGINAL "weather in Los Angeles" tool call was made, before we modified it to Louisiana.
to_replay = states[-3]
print(to_replay)
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}, next=('action',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c35d-6c36-8001-52372a1ac822'}}, metadata={'source': 'loop', 'step': 1, 'writes': {'llm': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}}}, created_at='2025-05-25T14:37:08.008844+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c324-6002-8000-81d957caa9af'}})

## Run LLM with the new state configuration
for event in abot.graph.stream(None, to_replay.config):
    for k, v in event.items():
        print(v)
## Calling: {'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}
## Back to the model!
## {'messages': [ToolMessage(content='[{\'url\': \'https://weathershogun.com/weather/usa/ca/los-angeles/451/may/2025-05-25\', \'content\': \'Los Angeles, California Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 77°. Night 61°. Precipitation 0 %.\'}, {\'url\': \'https://en.climate-data.org/north-america/united-states-of-america/california/los-angeles-714829/t/may-5/\', \'content\': "May is an excellent time to visit Los Angeles due to its mild and pleasant weather. With temperatures ranging from the mid-60s to low 70s Fahrenheit, it\'s perfect for exploring the city comfortably. During this month, you can enjoy clear skies and less crowded tourist spots. A must-visit is Griffith Observatory, where you can get stunning views of the city and the iconic Hollywood sign. Another great attraction is The Getty Center, offering impressive art collections and beautiful gardens. [...] (66.9) °F\\n\\n21.4 °C\\n\\n(70.5) °F\\n\\n23.3 °C\\n\\n(73.9) °F\\n\\n25.2 °C\\n\\n(77.4) °F\\n\\n28.1 °C\\n\\n(82.6) °F\\n\\n31.3 °C\\n\\n(88.3) °F\\n\\n31.9 °C\\n\\n(89.5) °F\\n\\n31 °C\\n\\n(87.7) °F\\n\\n27.2 °C\\n\\n(81) °F\\n\\n23.1 °C\\n\\n(73.5) °F\\n\\n18.8 °C\\n\\n(65.9) °F\\n\\n84\\n\\n(3)\\n\\n89\\n\\n(3)\\n\\n54\\n\\n(2)\\n\\n19\\n\\n(0)\\n\\n11\\n\\n(0)\\n\\n3\\n\\n(0)\\n\\n2\\n\\n(0)\\n\\n0\\n\\n(0)\\n\\n4\\n\\n(0)\\n\\n17\\n\\n(0)\\n\\n21\\n\\n(0)\\n\\n53\\n\\n(2) [...] Min. Temperature °C (°F) | 6.7 °C(44.1) °F | 6.8 °C(44.2) °F | 8.3 °C(47) °F | 9.7 °C(49.5) °F | 12.3 °C(54.1) °F | 15 °C(58.9) °F | 17.9 °C(64.3) °F | 18.2 °C(64.8) °F | 17 °C(62.6) °F | 13.6 °C(56.5) °F | 9.8 °C(49.7) °F | 6.5 °C(43.8) °F\\nMax. Temperature °C (°F) | 19.5 °C(67.2) °F | 19.4 °C(66.9) °F | 21.4 °C(70.5) °F | 23.3 °C(73.9) °F | 25.2 °C(77.4) °F | 28.1 °C(82.6) °F | 31.3 °C(88.3) °F | 31.9 °C(89.5) °F | 31 °C(87.7) °F | 27.2 °C(81) °F | 23.1 °C(73.5) °F | 18.8 °C(65.9) °F"}]', name='tavily_search_results_json', id='09816f75-1b7f-4bba-940a-cf2619dc6d4a', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc')]}
## {'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}]), ToolMessage(content='[{\'url\': \'https://weathershogun.com/weather/usa/ca/los-angeles/451/may/2025-05-25\', \'content\': \'Los Angeles, California Weather: Sunday, May 25, 2025. Cloudy weather, overcast skies with clouds. Day 77°. Night 61°. Precipitation 0 %.\'}, {\'url\': \'https://en.climate-data.org/north-america/united-states-of-america/california/los-angeles-714829/t/may-5/\', \'content\': "May is an excellent time to visit Los Angeles due to its mild and pleasant weather. With temperatures ranging from the mid-60s to low 70s Fahrenheit, it\'s perfect for exploring the city comfortably. During this month, you can enjoy clear skies and less crowded tourist spots. A must-visit is Griffith Observatory, where you can get stunning views of the city and the iconic Hollywood sign. Another great attraction is The Getty Center, offering impressive art collections and beautiful gardens. [...] (66.9) °F\\n\\n21.4 °C\\n\\n(70.5) °F\\n\\n23.3 °C\\n\\n(73.9) °F\\n\\n25.2 °C\\n\\n(77.4) °F\\n\\n28.1 °C\\n\\n(82.6) °F\\n\\n31.3 °C\\n\\n(88.3) °F\\n\\n31.9 °C\\n\\n(89.5) °F\\n\\n31 °C\\n\\n(87.7) °F\\n\\n27.2 °C\\n\\n(81) °F\\n\\n23.1 °C\\n\\n(73.5) °F\\n\\n18.8 °C\\n\\n(65.9) °F\\n\\n84\\n\\n(3)\\n\\n89\\n\\n(3)\\n\\n54\\n\\n(2)\\n\\n19\\n\\n(0)\\n\\n11\\n\\n(0)\\n\\n3\\n\\n(0)\\n\\n2\\n\\n(0)\\n\\n0\\n\\n(0)\\n\\n4\\n\\n(0)\\n\\n17\\n\\n(0)\\n\\n21\\n\\n(0)\\n\\n53\\n\\n(2) [...] Min. Temperature °C (°F) | 6.7 °C(44.1) °F | 6.8 °C(44.2) °F | 8.3 °C(47) °F | 9.7 °C(49.5) °F | 12.3 °C(54.1) °F | 15 °C(58.9) °F | 17.9 °C(64.3) °F | 18.2 °C(64.8) °F | 17 °C(62.6) °F | 13.6 °C(56.5) °F | 9.8 °C(49.7) °F | 6.5 °C(43.8) °F\\nMax. Temperature °C (°F) | 19.5 °C(67.2) °F | 19.4 °C(66.9) °F | 21.4 °C(70.5) °F | 23.3 °C(73.9) °F | 25.2 °C(77.4) °F | 28.1 °C(82.6) °F | 31.3 °C(88.3) °F | 31.9 °C(89.5) °F | 31 °C(87.7) °F | 27.2 °C(81) °F | 23.1 °C(73.5) °F | 18.8 °C(65.9) °F"}]', name='tavily_search_results_json', id='09816f75-1b7f-4bba-940a-cf2619dc6d4a', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc'), AIMessage(content='The weather in Los Angeles today is cloudy with overcast skies and temperatures reaching 77°F during the day and dropping to 61°F at night. There is no precipitation expected. Los Angeles in May generally has mild and pleasant weather with temperatures ranging from the mid-60s to low 70s Fahrenheit, making it perfect for exploring the city comfortably.', response_metadata={'token_usage': {'completion_tokens': 72, 'prompt_tokens': 1013, 'total_tokens': 1085, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-bdaa2a3d-3ca8-446a-81ce-1ed9f6dc3c8d-0')]}
## {'messages': [AIMessage(content='The weather in Los Angeles today is cloudy with overcast skies and temperatures reaching 77°F during the day and dropping to 61°F at night. There is no precipitation expected. Los Angeles in May generally has mild and pleasant weather with temperatures ranging from the mid-60s to low 70s Fahrenheit, making it perfect for exploring the city comfortably.', response_metadata={'token_usage': {'completion_tokens': 72, 'prompt_tokens': 1013, 'total_tokens': 1085, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-bdaa2a3d-3ca8-446a-81ce-1ed9f6dc3c8d-0')]}

## ------------------------------------------------------------------------------------------------

## WITH LANGGRAPH WE CAN ALSO GO BACK IN TIME AND EDIT

to_replay = states[-3]
print(to_replay)
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}, next=('action',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c35d-6c36-8001-52372a1ac822'}}, metadata={'source': 'loop', 'step': 1, 'writes': {'llm': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}}}, created_at='2025-05-25T14:37:08.008844+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c324-6002-8000-81d957caa9af'}})

_id = to_replay.values['messages'][-1].tool_calls[0]['id']
to_replay.values['messages'][-1].tool_calls = [{'name': 'tavily_search_results_json',
  'args': {'query': 'current weather in LA, accuweather'},
  'id': _id}]
branch_state = abot.graph.update_state(to_replay.config, to_replay.values)
print(branch_state)
## {'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in LA, accuweather'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}

for event in abot.graph.stream(None, branch_state):
    for k, v in event.items():
        if k != "__end__":
            print(v)
## Calling: {'name': 'tavily_search_results_json', 'args': {'query': 'current weather in LA, accuweather'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}
## Back to the model!
## {'messages': [ToolMessage(content='[{\'url\': \'https://www.accuweather.com/en/us/los-angeles/90012/weather-forecast/347625\', \'content\': \'Today\\\'s Weather. Sun, May 25. Low clouds giving way to sunshine Hi: 73 ... Long Beach, CA. © 2025 AccuWeather, Inc. "AccuWeather" and sun design are\'}, {\'url\': \'https://weather.com/weather/monthly/l/Los+Angeles+CA?canonicalCityId=7d3c65d8b80674fb48647ddbc936bb8b\', \'content\': \'Low 57F. Winds light and variable. Record Low47°. Average Low59°. Moonrise4:18 am. Waning Crescent. Moonset6:45 pm. Advertisement. Almanac. May 25, High, Low\'}]', name='tavily_search_results_json', id='659a5a43-39bf-4fd3-9402-f5ee19ceaa8c', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc')]}
## {'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in LA, accuweather'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}]), ToolMessage(content='[{\'url\': \'https://www.accuweather.com/en/us/los-angeles/90012/weather-forecast/347625\', \'content\': \'Today\\\'s Weather. Sun, May 25. Low clouds giving way to sunshine Hi: 73 ... Long Beach, CA. © 2025 AccuWeather, Inc. "AccuWeather" and sun design are\'}, {\'url\': \'https://weather.com/weather/monthly/l/Los+Angeles+CA?canonicalCityId=7d3c65d8b80674fb48647ddbc936bb8b\', \'content\': \'Low 57F. Winds light and variable. Record Low47°. Average Low59°. Moonrise4:18 am. Waning Crescent. Moonset6:45 pm. Advertisement. Almanac. May 25, High, Low\'}]', name='tavily_search_results_json', id='659a5a43-39bf-4fd3-9402-f5ee19ceaa8c', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc'), AIMessage(content='The current weather in Los Angeles is low clouds giving way to sunshine with a high of 73°F. If you need more detailed information, you can visit [AccuWeather](https://www.accuweather.com/en/us/los-angeles/90012/weather-forecast/347625).', response_metadata={'token_usage': {'completion_tokens': 61, 'prompt_tokens': 371, 'total_tokens': 432, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-f790a9d3-ff46-44d4-855b-7d6fb43c8d4b-0')]}
## {'messages': [AIMessage(content='The current weather in Los Angeles is low clouds giving way to sunshine with a high of 73°F. If you need more detailed information, you can visit [AccuWeather](https://www.accuweather.com/en/us/los-angeles/90012/weather-forecast/347625).', response_metadata={'token_usage': {'completion_tokens': 61, 'prompt_tokens': 371, 'total_tokens': 432, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-f790a9d3-ff46-44d4-855b-7d6fb43c8d4b-0')]}


## ------------------------------------------------------------------------------------------------

## WITH LANGGRAPH WE CAN ALSO ADD A MESSAGE TO A STATE AT A GIVEN TIME

print(to_replay)
## StateSnapshot(values={'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in LA, accuweather'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}, next=('action',), config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c35d-6c36-8001-52372a1ac822'}}, metadata={'source': 'loop', 'step': 1, 'writes': {'llm': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}])]}}}, created_at='2025-05-25T14:37:08.008844+00:00', parent_config={'configurable': {'thread_id': '3', 'thread_ts': '1f03975b-c324-6002-8000-81d957caa9af'}})

_id = to_replay.values['messages'][-1].tool_calls[0]['id']
## tool_calls[0] will look like: {'name': 'tavily_search_results_json', 'args': {'query': 'current weather in LA, accuweather'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}
## _id will look like: 'call_6ED1ZQ8nrjYIOY14yqInLPZc'
state_update = {"messages": [ToolMessage(
    tool_call_id=_id,
    name="tavily_search_results_json",
    content="54 degree celcius",
)]}

branch_and_add = abot.graph.update_state(
    to_replay.config, 
    state_update, 
    ## as_node specifies which node in the graph should be treated as the source of this update
    as_node="action")

for event in abot.graph.stream(None, branch_and_add):
    for k, v in event.items():
        print(v)
## {'messages': [HumanMessage(content='Whats the weather in LA?', id='7bbede07-cf27-480e-ac41-1768a38c1eee'), AIMessage(content='', additional_kwargs={'tool_calls': [{'function': {'arguments': '{"query":"weather in Los Angeles"}', 'name': 'tavily_search_results_json'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc', 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'logprobs': None, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'token_usage': {'completion_tokens': 22, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens': 152, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'total_tokens': 174}}, id='run-7a521ee2-1701-4590-b798-f72381754bd9-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'weather in Los Angeles'}, 'id': 'call_6ED1ZQ8nrjYIOY14yqInLPZc'}]), ToolMessage(content='54 degree celcius', name='tavily_search_results_json', id='1a49f29a-8a4e-42a5-a6ca-bede6c2da973', tool_call_id='call_6ED1ZQ8nrjYIOY14yqInLPZc'), AIMessage(content='The current weather in Los Angeles is 54 degrees Celsius.', response_metadata={'token_usage': {'completion_tokens': 14, 'prompt_tokens': 190, 'total_tokens': 204, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-92b2c32d-604a-491d-8baa-4898c6ff5392-0')]}
## {'messages': [AIMessage(content='The current weather in Los Angeles is 54 degrees Celsius.', response_metadata={'token_usage': {'completion_tokens': 14, 'prompt_tokens': 190, 'total_tokens': 204, 'prompt_tokens_details': {'cached_tokens': 0, 'audio_tokens': 0}, 'completion_tokens_details': {'reasoning_tokens': 0, 'audio_tokens': 0, 'accepted_prediction_tokens': 0, 'rejected_prediction_tokens': 0}}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-92b2c32d-604a-491d-8baa-4898c6ff5392-0')]}